\chapter{绪论}
\label{chap:intro}

\section{研究背景}

3D人脸重建是计算机视觉和计算机图形学领域的一个热门研究方向。
相比于传统计算机视觉对2D照片的判断、识别和生成，3D的人脸表示更加贴近实际，并可以建模光照和视角产生的影响。
例如，3D人脸模型可显式地表达人脸在3D空间中的位置，姿态甚至表情和骨骼的位置；
高质量的模型可用于逼真地一致地渲染出不同环境和视角下的人脸图像。

3D人脸模型带来的优势是以更复杂的成像过程为代价的，这通常会限制其范围。
3D人脸信息通常使用立体视觉系统\citep{DEP,ss_geo}、3D激光扫描仪（例如NextEngine和Cyberware）或RGB-D相机\citep{li2023}（如Kinect）进行捕获。
前两种捕获高质量的人脸扫描，但需要受控环境和昂贵的机器。
相比之下，RGB-D相机更便宜，更易于使用，但所得到的扫描质量有限。

\changed{
在计算机图形学领域，
高质量的人脸模型已经可以在计算机中忠实地重现人脸，
包括角质层的凹凸、毛孔、皱纹、镜面反射和次表面散射等复杂特性。
这些模型已经在影视、游戏、动画、虚拟现实等领域中广泛应用,
但是其获取成本非常高昂。
目前成熟的影视级的3D人脸重建方案仍是昂贵的商业解决方案，
其中包括大量复杂的步骤，并需要大量美术和技术人员参与制作\footnote{https://blog.unity.com/technology/making-of-the-heretic-digital-human-character-gawain}。
这些高精度重建方案通常使用专用设备在受控环境扫描的精细数据。
它们基于专业的摄影设备和完全受控的数据处理流程，
通过摄影测量的方法，使用相机作为测量仪器精确定量地测定各个方向上光线强度。
并基于较为准确的光学模型重建人脸的几何和材质。
}

相比之下，能从普通非受限环境的照片或视频中重建3D人脸模型的高效重建方法受到了广泛关注。
这类方法只需要最少单张手机随意拍摄的照片即可实时完成3D重建。
它结合了2D图像拍摄的便捷性和3D人脸模型的优势，
其应用非常广泛，目前已被用于人脸识别\citep{BlanzV03,1022631413.nh,zhu2015high}、人脸表情捕捉\cite{Mo2022TowardsAF}、人脸跟踪\citep{Pham2016RobustRP}、人脸动画合成\citep{Cao20133DSR,thies2016face2face}等任务中，并有代替人脸关键点识别等2D分析方法的潜力。

然而，该任务如今依然非常具有挑战性。
从少量非受限环境中拍摄的照片重建3D模型是高度不适定的。
算法需要从单张照片中估计出人脸几何形状、头部姿势和纹理、环境光照等参数，
参数空间很大，而不同解之间存在歧义，因为同一张照片可以从不同的3D模型中生成，
并且很难确定哪个模型才更加准确。
因此该任务必须结合有关人脸的先验知识才能完成。

基于人脸3D可形变模型（3D Morphable Model，简称3DMM）和神经网络的方法能以数据驱动的方式更好地建模有关人脸的先验知识。
3DMM是从大量人脸3D扫描中得到的统计模型，其先验知识通常编码于均值、方差等统计量中；
而神经网络则能从各种各样的监督信号中学习先验知识，例如3D模型、照片、关键点或高阶的人脸识别特征等。
这些先验知识有助于缓解3D重建的解之间的歧义。
在这些方法的加持下，我们虽然已经能高效地获得较为准确的人脸3D模型，
但这些模型都牺牲了大多数环境以及人脸表面上的细节，无法再次渲染从而忠实地还原照片，
因而并不能直接应用于影视，游戏等工业领域中。
另外，部分监督信号需要较为复杂的额外步骤才能得到，且可能引入额外的误差，
例如人脸关键点检测中，部分关键点的位置不论在照片或是在3D模型上都难以准确定义。
可以预见，在数字孪生和元宇宙等概念走入公众视野的今天，
基于现实的形象批量生产高渲染质量的人脸模型将涌现新的需求，
基于少量非受限环境照片的方便快捷的3D人脸重建技术具有重要现实意义。

在人脸重建方法中，可微分渲染技术已占有一席之地。
该技术旨在准确估计3D渲染结果关于其渲染参数（模型、光照等）的梯度，
从而引入直接的合成分析(Analysis by Synthesis)方法，也即逆渲染方法。
如今从模型渲染图片的过程已十分复杂，且随着计算机图形学和神经渲染等技术的发展还在不断进化，对人脸则更是如此。
而逆渲染方法则直接将渲染结果和输入照片进行比较，根据渲染的误差来优化渲染参数，以此适应任意复杂的渲染方式。
可微分渲染则可以支持以简单的梯度下降法实现该优化过程，
具有通用、准确、自动化等优点，可谓是3D模型与2D照片之间的桥梁。
得益于此，基于非受限环境照片的高效重建方法得以直接从大量无标注的人脸照片的数据集中学习3D人脸模型的先验知识。
\changed{利用专业采集设备的高精度方案也能获得更准确的材质参数。}

然而，当前可微分渲染在人脸重建领域的应用还非常初步：
在渲染过程的梯度中，由于模型的不同部分之间相互遮挡而产生的可见性梯度通常最为显著，
这些梯度对模型与照片中的边缘的精确对齐至关重要。
但由于渲染采样过程的离散性，这些梯度往往难以估计。
在基于非受限环境照片的方法中，拍摄环境，相机参数，后处理流程等诸多不确定因素更提升了可见性梯度的估计难度。
现有人脸重建方法均仅考虑了逐像素着色的梯度，忽略了这些难以利用的可见性梯度，而是依赖更加成熟的多目立体（multi-view stereo, MVS）或人脸关键点检测等方法。
这导致了现有方法无法仅依赖可微分渲染来确定人脸的几何结构，而需要额外的步骤。
但额外步骤将增加重建流程的复杂性，且导致误差在多个环节中累积。

\changed{
综上，3D人脸重建技术应用广泛。
但现有高精度人脸重建方法所需数据采集环境要求高，实施困难。
在基于非受限环境照片的方法中，对可微分渲染的应用仍有待进一步发展。
}

\section{本文研究内容及贡献}

\changed{
本文主要研究3D人脸重建方法的理论与应用。
本文提出了一套高精度多视角数据采集方案，解决了高精度人脸重建所需的数据采集环境要求高，实施困难的问题。}
本文从可微分渲染在3D人脸重建中应用时遇到的实际问题出发，
提出了改进的理论，并在实践中验证了其有效性。
本文的主要贡献可概括如下：

\begin{enumerate}
\item \changed{影视级真实的渲染效果离不开基于物理的渲染管线和精确的几何与材质数据。
若要获取这些数据，则需要精确的基于物理的测定。
本文提出了一套多视角人脸数据采集方案。
其旨在通过软硬件协同设计，对全流程的高精度控制，实现在精确的时间点、位置，高分辨率高精度地测定物体反射光线强度数据，
从而为基于物理的可微分渲染的优化提供坚实的基础。
本文介绍了该采集方案的软硬件设计，设备标定校准方法，使用交互方式和实现验证结果。}

\item 针对可微分渲染在应用到3D人脸重建时，模型与背景交界处的可见性梯度难以被估计的问题，
本文从理论上分析了其原因是缺乏对背景的建模。
在缺乏对非受限环境中背景的先验知识的前提下，本文提出了面积归一化的像素损失，
以对可微分渲染的损失函数进行改进。
本文通过收缩、扩展两项梯度分析了其作用机理，
并提出了一种几乎无需额外计算和存储开销的方式实现这项改进。
本文通过实验证明了该项改进可以达成既定的目标：
在不对背景建模的情况下，使3D几何模型与照片中的物体边缘良好对齐。

\item 本文实现了一种通过单张在非受限环境中拍摄的照片，重建3D人脸模型的方案。
本文通过集成神经网络和3DMM人脸模型以提升鲁棒性；
通过可微分渲染技术实现更精准的对齐，
并在前述理论的基础上提出了一种基于SDF贴图的方法消除了人工裁剪的边缘带来的异常梯度；
还集成一些传统算法以在3D模型上重现照片中的更多细节。
该方案中的逆渲染优化过程仅使用了像素损失函数，
以非常简单的流程实现了精确的边缘对齐
取各家所长，该方案最终实现了细节丰富且全自动的，基于单张非受限环境照片的3D人脸模型重建。
其输出的3D人脸模型可支持在一定视角、光照和表情变化内较为逼真地重新渲染。

\end{enumerate}
\changed{本文的研究内容及其关系总结如图\ref{fig:structure}所示。}

\begin{figure}[htb]
    \centering
    \begin{tikzpicture}[
        level 1/.style={sibling distance=7.7cm},
        level 2/.style={sibling distance=4.7cm, nodes={font=\small,draw}, align=center},
        level 4/.style={nodes={draw=none, font=\normalsize}},
        t/.style={align=center, text width=2em, font=\bf},
    ]
        \linespread{1.1}
        \node (title) {\bf 高精度3D人脸重建关键环境及可微分渲染技术研究}
        child {
            node (high) {使用专业设备的高精度方法}
            child {
                node (problem1) {采集环境要求高，实施困难}
                child {
                    node (content1) {多视角人脸数据采集方案}
                    child {node (chap3) {第\ref{chap:platform}章}}
                }
            }
        }
        child {
            node (efficient) {基于非受限环境照片的方法}
            child {
                node {未能充分利用可微分渲染}
                child {
                    node {适应未知背景的可微分逆渲染}
                    child {node (chap4) {第\ref{chap:method}章}}
                }
            }
            child {
                node {裁剪边缘的异常梯度}
                child {
                    node {人脸重建实现}
                    child {node (chap5) {第\ref{chap:recon}章}}
                }
            }
        };

        \node (t1) [t,left=5mm of problem1] {问题};
        \node at (content1 -| t1) [t] {研究内容};
        \node at (chap3 -| t1) [t] {对应章节};

        \path [->,draw] (chap4) -- node [above] {\small 应用} (chap5);
    \end{tikzpicture}
    \caption{本文的研究内容及其关系}
    \label{fig:structure}
\end{figure}

\section{本文组织结构}

本文正文共分为6个章节，各章节的主要内容如下：

\newcommand*{\chapref}[1]{\hyperref[{#1}]{第\ref*{#1}章 \nameref*{#1}}}

\chapref{chap:intro}。
本章介绍了3D人脸重建、以及可微分渲染的背景、关联及其研究意义，
并总结了本文主要贡献及各章节的内容安排。

\chapref{chap:related_work}。
本章对课题相关的研究内容进行了综述，
其中包括使用专业设备的和非受限环境下的3D人脸重建、以及可微分渲染相关方向的研究和实践。
此外，还介绍了一些可用于3D人脸渲染的计算机图形学的基础知识。

\changed{
\chapref{chap:platform}。
为了更专业地采集基于物理的人脸渲染所需的材质数据，
本章介绍了一个多视角人脸数据采集方案。
该方案中定制的软硬件能够实现高分辨率人脸照片的便捷多视角采集，
并为后续的数据收集整理，相机、光源标定等重建所必备的步骤提供了软件支持。
本章将介绍该平台的软硬件设计思路、实现细节、使用方法以及其产出数据可能的应用。
}

\chapref{chap:method}。
本章介绍了本文提出的一种对现有可微分渲染的改进方法。
该方法能增强可微分渲染技术在难以建模背景的图像拟合任务中的适应能力。
其理论构建在修改的损失函数之上，并通过收缩、扩展两项梯度项来实现。
本章也通过实验验证了该方法的有效性。

\chapref{chap:recon}。
利用上一章提出的方法，本章介绍了一个从单张非受限环境照片重建3D人脸的实现。
该实现解决了人工裁剪的边缘处异常梯度的问题，
同时有机结合了神经网络、可微分渲染和一些传统算法，
达成了快速高效，细节丰富且全自动的3D人脸模型重建。
本章也与其他相关工作进行了比较。

\nameref{chap:conclusion}。
基于本文完成的工作结果对本文研究进行总结，并分析当前工作存在的不足和对未来工作的展望。
